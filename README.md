# üöÄ Projet Ansible d'Apprentissage

Bienvenue dans ce projet Ansible minimaliste mais complet, con√ßu sp√©cialement pour l'apprentissage des concepts fondamentaux d'Ansible.

## üìã Table des Mati√®res

- [Vue d'ensemble](#-vue-densemble)
- [Pr√©requis](#-pr√©requis)
- [Structure du projet](#-structure-du-projet)
- [Premiers pas](#-premiers-pas)
- [Concepts Ansible expliqu√©s](#-concepts-ansible-expliqu√©s)
- [Commandes utiles](#-commandes-utiles)
- [D√©pannage](#-d√©pannage)
- [Exercices pratiques](#-exercices-pratiques)
- [Prochaines √©tapes](#-prochaines-√©tapes)

## üéØ Vue d'ensemble

Ce projet d√©ploie automatiquement un serveur web Apache avec une page d'accueil personnalis√©e. Il illustre les bonnes pratiques Ansible tout en restant simple √† comprendre.

### Fonctionnalit√©s

- ‚úÖ Installation et configuration automatique d'Apache
- ‚úÖ Page web dynamique avec informations syst√®me
- ‚úÖ Configuration adaptative (Ubuntu/Debian et CentOS/RHEL)
- ‚úÖ Gestion des services et handlers
- ‚úÖ Utilisation des templates Jinja2
- ‚úÖ Variables hi√©rarchis√©es
- ‚úÖ Tests et validations automatiques

## üîß Pr√©requis

### Sur votre machine de contr√¥le (l√† o√π vous ex√©cutez Ansible)

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install ansible python3-pip

# CentOS/RHEL/Fedora
sudo yum install epel-release
sudo yum install ansible python3-pip

# macOS
brew install ansible

# V√©rifier l'installation
ansible --version
```

### Sur les serveurs cibles

- Acc√®s SSH configur√©
- Utilisateur avec privil√®ges sudo
- Python install√© (g√©n√©ralement pr√©sent par d√©faut)

## üìÅ Structure du projet

```
ansible-learning/
‚îú‚îÄ‚îÄ ansible.cfg                    # Configuration Ansible
‚îú‚îÄ‚îÄ README.md                      # Ce fichier - documentation principale
‚îú‚îÄ‚îÄ CLAUDE.md                      # Instructions pour Claude Code
‚îú‚îÄ‚îÄ inventories/                   # Inventaires multi-environnements
‚îÇ   ‚îú‚îÄ‚îÄ production                 # Serveurs de production (localhost)
‚îÇ   ‚îú‚îÄ‚îÄ staging                    # Serveurs de staging
‚îÇ   ‚îî‚îÄ‚îÄ docker                     # Conteneurs Docker pour tests
‚îú‚îÄ‚îÄ playbooks/                     # Playbooks organis√©s
‚îÇ   ‚îú‚îÄ‚îÄ site.yml                   # Playbook principal (point d'entr√©e)
‚îÇ   ‚îú‚îÄ‚îÄ site-local.yml             # Version sans sudo pour tests locaux
‚îÇ   ‚îú‚îÄ‚îÄ site-docker.yml            # D√©ploiement sur conteneurs Docker
‚îÇ   ‚îú‚îÄ‚îÄ demo-tags.yml              # D√©monstration des tags Ansible
‚îÇ   ‚îú‚îÄ‚îÄ docker-test.yml            # Tests avec Docker
‚îÇ   ‚îî‚îÄ‚îÄ test-suite.yml             # Suite de tests compl√®te
‚îú‚îÄ‚îÄ group_vars/                    # Variables par groupe
‚îÇ   ‚îú‚îÄ‚îÄ all.yml                    # Variables globales
‚îÇ   ‚îî‚îÄ‚îÄ webservers.yml             # Variables sp√©cifiques aux serveurs web
‚îú‚îÄ‚îÄ roles/                         # R√¥les r√©utilisables
‚îÇ   ‚îî‚îÄ‚îÄ webserver/                 # R√¥le de serveur web Apache
‚îÇ       ‚îú‚îÄ‚îÄ tasks/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ main.yml           # T√¢ches principales
‚îÇ       ‚îú‚îÄ‚îÄ handlers/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ main.yml           # Handlers (red√©marrages)
‚îÇ       ‚îú‚îÄ‚îÄ templates/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.html.j2      # Template de page web Jinja2
‚îÇ       ‚îú‚îÄ‚îÄ defaults/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ main.yml           # Variables par d√©faut
‚îÇ       ‚îî‚îÄ‚îÄ molecule/              # Tests Molecule (Docker)
‚îÇ           ‚îú‚îÄ‚îÄ default/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ molecule.yml   # Configuration Molecule
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ converge.yml   # Sc√©nario de test
‚îÇ           ‚îî‚îÄ‚îÄ Dockerfile.j2      # Template pour conteneurs de test
‚îú‚îÄ‚îÄ tests/                         # Tests Ansible natifs
‚îÇ   ‚îú‚îÄ‚îÄ test-webserver.yml         # Tests du r√¥le webserver complet
‚îÇ   ‚îî‚îÄ‚îÄ test-webserver-local.yml   # Tests locaux sans sudo
‚îî‚îÄ‚îÄ docs/                          # Documentation compl√©mentaire
    ‚îú‚îÄ‚îÄ QUICKSTART.md              # D√©marrage rapide
    ‚îú‚îÄ‚îÄ GUIDE-TESTS.md             # Guide des tests
    ‚îú‚îÄ‚îÄ LECON-2-DOCKER-MULTI-OS.md # Le√ßon sur Docker et multi-OS
    ‚îú‚îÄ‚îÄ MACOS-VS-LINUX.md          # Diff√©rences macOS/Linux
    ‚îî‚îÄ‚îÄ RECAPITULATIF-COMPLET.md   # R√©capitulatif complet du projet
```

### Explication de la structure

**üìÑ `ansible.cfg`** : Configure Ansible pour l'apprentissage (d√©sactive la v√©rification SSH, etc.)

**üìÅ `inventories/`** : Diff√©rents inventaires pour production, staging et tests Docker

**üìÅ `playbooks/`** : Playbooks organis√©s par usage (principal, tests, d√©monstrations)
- `site.yml` : Point d'entr√©e principal - orchestre tout le d√©ploiement

**üìÅ `group_vars/`** : Variables qui s'appliquent √† des groupes de serveurs
- `all.yml` : Variables pour tous les serveurs
- `webservers.yml` : Variables sp√©cifiques au groupe webservers

**üìÅ `roles/`** : Logique r√©utilisable organis√©e par composants

**üìÅ `tests/`** : Tests Ansible natifs (recommand√©s pour l'apprentissage)

**üìÅ `docs/`** : Documentation compl√©mentaire et guides d√©taill√©s

## üöÄ Premiers pas

### 1. Clonage et pr√©paration

```bash
# Se placer dans le r√©pertoire du projet
cd ansible-learning

# V√©rifier la structure
ls -la
```

### 2. Premier test sur localhost

```bash
# Tester la connectivit√©
ansible all -m ping

# R√©sultat attendu :
# localhost | SUCCESS => {
#     \"changed\": false,
#     \"ping\": \"pong\"
# }
```

### 3. Ex√©cution du playbook

```bash
# Ex√©cution compl√®te (n√©cessite sudo)
ansible-playbook playbooks/site.yml

# Version locale sans sudo (recommand√©e pour d√©buter)
ansible-playbook playbooks/site-local.yml

# Ex√©cution avec plus de d√©tails
ansible-playbook playbooks/site.yml -v

# Ex√©cution pas-√†-pas (demande confirmation)
ansible-playbook playbooks/site.yml --step

# Test sans modification (dry-run)
ansible-playbook playbooks/site.yml --check

# D√©monstration des tags
ansible-playbook playbooks/demo-tags.yml
```

### 4. Ex√©cution des tests

```bash
# Tests locaux sans sudo (recommand√© pour d√©buter)
ansible-playbook tests/test-webserver-local.yml

# Tests complets du webserver (n√©cessite Apache install√©)
ansible-playbook tests/test-webserver.yml

# Suite de tests compl√®te (performance, s√©curit√©)
ansible-playbook playbooks/test-suite.yml

# Tests Molecule avec Docker (avanc√©)
cd roles/webserver && molecule test
```

### 5. V√©rification du r√©sultat

```bash
# Tester le serveur web
curl http://localhost

# Ou dans un navigateur
open http://localhost
```

## üìö Concepts Ansible expliqu√©s

### üé≠ Playbooks

Un **playbook** est comme une recette de cuisine qui d√©crit :
- Quels serveurs configurer (`hosts`)
- Quelles actions effectuer (`tasks` ou `roles`)
- Dans quel ordre (`pre_tasks`, `roles`, `post_tasks`)

```yaml
- name: \"Installer un serveur web\"
  hosts: webservers
  become: true
  roles:
    - webserver
```

### üì¶ R√¥les

Un **r√¥le** est un ensemble coh√©rent de t√¢ches pour un composant sp√©cifique :

```
roles/webserver/
‚îú‚îÄ‚îÄ tasks/      # Ce qu'il faut faire
‚îú‚îÄ‚îÄ handlers/   # R√©actions aux changements
‚îú‚îÄ‚îÄ templates/  # Fichiers √† personnaliser
‚îî‚îÄ‚îÄ defaults/   # Valeurs par d√©faut
```

### üîß Variables

Ansible utilise une hi√©rarchie de variables (de la plus haute √† la plus basse priorit√©) :

1. **Ligne de commande** : `ansible-playbook -e \"port=8080\"`
2. **Variables de playbook** : `vars:` dans le playbook
3. **Variables de groupe** : `group_vars/webservers.yml`
4. **Variables globales** : `group_vars/all.yml`
5. **Variables par d√©faut** : `roles/*/defaults/main.yml`

### üé® Templates

Les **templates** utilisent Jinja2 pour g√©n√©rer des fichiers dynamiques :

```html
<h1>Serveur: {{ inventory_hostname }}</h1>
<p>IP: {{ ansible_default_ipv4.address }}</p>
```

### üîÑ Handlers

Les **handlers** s'ex√©cutent uniquement quand notifi√©s et √† la fin :

```yaml
# Dans tasks/main.yml
- name: \"Modifier la configuration\"
  template: src=config.j2 dest=/etc/apache2/apache2.conf
  notify: restart apache

# Dans handlers/main.yml
- name: restart apache
  service: name=apache2 state=restarted
```

### üè∑Ô∏è Tags

Les **tags** permettent l'ex√©cution s√©lective :

```bash
# Ex√©cuter seulement les t√¢ches avec le tag \"install\"
ansible-playbook playbooks/site.yml --tags \"install\"

# Ignorer les t√¢ches avec le tag \"slow\"
ansible-playbook playbooks/site.yml --skip-tags \"slow\"
```

## üõ†Ô∏è Commandes utiles

### Commandes de base

```bash
# Lister tous les serveurs
ansible all --list-hosts

# Tester la connectivit√©
ansible all -m ping

# Ex√©cuter une commande sur tous les serveurs
ansible all -m command -a \"uptime\"

# V√©rifier la syntaxe d'un playbook
ansible-playbook playbooks/site.yml --syntax-check

# Voir quels serveurs seraient affect√©s
ansible-playbook playbooks/site.yml --list-hosts
```

### Commandes de d√©bogage

```bash
# Mode verbeux (plusieurs niveaux possibles)
ansible-playbook playbooks/site.yml -v     # Basic
ansible-playbook playbooks/site.yml -vv    # More
ansible-playbook playbooks/site.yml -vvv   # Debug
ansible-playbook playbooks/site.yml -vvvv  # Connection debug

# Voir toutes les variables d'un serveur
ansible localhost -m setup

# Voir des variables sp√©cifiques
ansible localhost -m setup -a \"filter=ansible_default_ipv4\"
```

### Commandes avanc√©es

```bash
# Ex√©cuter seulement certaines t√¢ches
ansible-playbook playbooks/site.yml --tags \"webserver,config\"

# Cibler un serveur sp√©cifique
ansible-playbook playbooks/site.yml --limit \"localhost\"

# Commencer √† partir d'une t√¢che sp√©cifique
ansible-playbook playbooks/site.yml --start-at-task=\"D√©marrer le service web\"

# Mode diff√©rentiel (voir les changements)
ansible-playbook playbooks/site.yml --diff
```

## üîç D√©pannage

### Probl√®mes courants

**‚ùå Erreur de connexion SSH**
```bash
# V√©rifier la connectivit√©
ansible all -m ping

# Si √©chec, v√©rifier la configuration SSH
ssh localhost
```

**‚ùå Permission denied (sudo)**
```bash
# V√©rifier les privil√®ges sudo
ansible all -m command -a \"sudo whoami\" --become

# Ou modifier l'inventaire pour sp√©cifier l'utilisateur
echo \"localhost ansible_connection=local ansible_user=votre_utilisateur\" > inventory
```

**‚ùå Service web ne d√©marre pas**
```bash
# V√©rifier manuellement
sudo systemctl status apache2
sudo journalctl -u apache2

# V√©rifier les ports
sudo netstat -tlnp | grep :80
```

### Debug pas-√†-pas

```bash
# 1. V√©rifier la syntaxe
ansible-playbook playbooks/site.yml --syntax-check

# 2. Voir ce qui serait fait sans le faire
ansible-playbook playbooks/site.yml --check

# 3. Ex√©cuter avec des d√©tails
ansible-playbook playbooks/site.yml -vv

# 4. Ex√©cuter √©tape par √©tape
ansible-playbook playbooks/site.yml --step
```

### Logs et diagnostics

```bash
# Logs d'Apache
sudo tail -f /var/log/apache2/error.log
sudo tail -f /var/log/apache2/access.log

# Statut du service
sudo systemctl status apache2

# V√©rifier la configuration Apache
sudo apache2ctl configtest
```

## üéì Exercices pratiques

### Exercice 1 : Modifier le port

1. Changez le port du serveur web de 80 √† 8080
2. Indices : regardez dans `group_vars/all.yml` et `roles/webserver/defaults/main.yml`

### Exercice 2 : Personnaliser la page

1. Modifiez le template `index.html.j2` pour ajouter votre nom
2. Changez la couleur du th√®me

### Exercice 3 : Ajouter un serveur distant

1. Ajoutez un vrai serveur dans l'inventaire
2. Configurez l'acc√®s SSH
3. D√©ployez sur ce serveur

### Exercice 4 : Cr√©er de nouvelles variables

1. Ajoutez une variable `company_name` dans `group_vars/all.yml`
2. Utilisez cette variable dans le template

### Exercice 5 : Tags et ex√©cution s√©lective

1. Ajoutez des tags √† certaines t√¢ches
2. Ex√©cutez seulement les t√¢ches d'installation

### Solutions des exercices

<details>
<summary>Solution Exercice 1 (cliquez pour voir)</summary>

```yaml
# Dans group_vars/all.yml
default_http_port: 8080

# Ou en ligne de commande
ansible-playbook playbooks/site.yml -e \"webserver_port=8080\"
```
</details>

## üìñ Documentation compl√©mentaire

Ce projet contient une documentation exhaustive dans le r√©pertoire `docs/` :

- **[QUICKSTART.md](docs/QUICKSTART.md)** : Guide de d√©marrage rapide pour commencer imm√©diatement
- **[GUIDE-TESTS.md](docs/GUIDE-TESTS.md)** : Guide complet sur les tests (natifs et Molecule)
- **[LECON-2-DOCKER-MULTI-OS.md](docs/LECON-2-DOCKER-MULTI-OS.md)** : Le√ßon sur Docker et tests multi-OS
- **[MACOS-VS-LINUX.md](docs/MACOS-VS-LINUX.md)** : Diff√©rences entre macOS et Linux pour Ansible
- **[RECAPITULATIF-COMPLET.md](docs/RECAPITULATIF-COMPLET.md)** : R√©capitulatif complet du projet

## üöÄ Prochaines √©tapes

Une fois que vous ma√Ætrisez ce projet, voici comment progresser :

### 1. Ajouter de la complexit√©

```bash
# Cr√©er des environnements multiples
mkdir -p group_vars/{development,production}

# Ajouter de nouveaux r√¥les
mkdir -p roles/{database,monitoring}

# Utiliser des inventaires dynamiques
# (AWS, Azure, etc.)
```

### 2. Bonnes pratiques avanc√©es

- **Ansible Vault** : Chiffrement des mots de passe
- **Tests automatis√©s** : Molecule pour tester les r√¥les
- **CI/CD** : Int√©gration avec GitLab/GitHub Actions
- **Collections** : Utilisation des collections Ansible Galaxy

### 3. Ressources pour approfondir

- üìñ [Documentation officielle Ansible](https://docs.ansible.com/)
- üè™ [Ansible Galaxy](https://galaxy.ansible.com/) - R√¥les communautaires
- üé• [Ansible YouTube Channel](https://www.youtube.com/ansibleautomation)
- üìö Livres recommand√©s :
  - \"Ansible for DevOps\" par Jeff Geerling
  - \"Ansible: Up and Running\" par Lorin Hochstein

### 4. Projets sugg√©r√©s

1. **Serveur LAMP complet** (Linux + Apache + MySQL + PHP)
2. **D√©ploiement d'application** (avec base de donn√©es et reverse proxy)
3. **Infrastructure monitoring** (avec Prometheus/Grafana)
4. **D√©ploiement multi-environnement** (dev/staging/prod)

## ü§ù Contribution

Ce projet est √©ducatif. N'h√©sitez pas √† :

- üêõ Signaler des bugs
- üí° Proposer des am√©liorations
- üìñ Am√©liorer la documentation
- üéØ Ajouter des exercices

## üìÑ License

Ce projet est sous licence MIT - voir le fichier LICENSE pour plus de d√©tails.

---

**üí° Conseil** : N'h√©sitez pas √† exp√©rimenter ! Ansible est idempotent, vous pouvez relancer le playbook autant de fois que vous voulez sans risque.

**üéØ Objectif** : Comprendre les concepts, pas m√©moriser les commandes. Une fois les concepts acquis, la syntaxe viendra naturellement.

Bon apprentissage avec Ansible ! üöÄ